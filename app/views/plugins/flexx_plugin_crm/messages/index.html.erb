<% content_for :js do %>
  <%= javascript_include_tag 'plugins/flexx_plugin_crm/messages' %>
  <%= javascript_include_tag 'plugins/flexx_plugin_next_admin/ckeditor' %>
<% end %>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    //grabs the hash tag from the url
    var hash = window.location.hash;
    //checks whether or not the hash tag is set
    if (hash != "") {
      //removes all active classes from tabs
      $('#tabs a').each(function() {
        $(this).removeClass('active');
      });
      $('#message-tab-content div').each(function() {
        $(this).removeClass('active show');
      });
      //this will add the active class on the hashtagged value
      var link = "";
      $('#tabs a').each(function() {
        link = $(this).attr('href');
        if (link == hash) {
          $(this).addClass('active');
        }
      });
      $('#message-tab-content div').each(function() {
        link = $(this).attr('id');
        if ('#'+link == hash) {
          $(this).addClass('active show');
        }
      });
    }

    $("#timing_detail").hide();
    var rad = document.newTextBlast.timingOptions;
    $(rad).on('click change', function(e) {
      if (rad.value == 2) {
        $("#timing_detail").show();
        $("#btn_send_text").text('Schedule Message');
      } else {
        $("#timing_detail").hide();
        $("#btn_send_text").text('Send Message');
      }
    });

    $("#timing_detail2").hide();
    var rad2 = document.newEmailBlast.timingOptions2;
    $(rad2).on('click change', function(e) {
      if (rad2.value == 2) {
        $("#timing_detail2").show();
        $("#btn_send_email").text('Schedule Message');
      } else {
        $("#timing_detail2").hide();
        $("#btn_send_email").text('Send Message');
      }
    });

    /*
    new Chart($("#chart-line-2"), {
      type: 'line',

      // Data
      //
      data: {
        labels: ["January", "February", "March", "April"],
        datasets: [
          {
            label: "Revenue",
            fill: false,
            borderWidth: 3,
            pointRadius: 5,
            borderColor: "#9966ff",
            pointBackgroundColor: "#9966ff",
            pointBorderColor: "#9966ff",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "#9966ff",
            data: [30, 25, 35, 23]
          }
        ]
      },

      // Options
      //
      options: {
        legend: {
          display: false
        },
      }
    });
    */
  });
</script>

<style>
  .ck-editor__editable {
    min-height: 350px;
  }
</style>

<header class="header">
  <%= render 'next/partials/breadcrumb', link: '/admin/next/contacts', page: 'CRM' %>
  <div class="header-info">
    <div class="left">
      <h2 class="header-title"><strong>Message Blast</strong></h2>
    </div>
  </div>

  <div class="header-action">
    <nav class="nav" id="header-tabs">
      <a class="nav-link active" data-toggle="tab" href="#tab-email">Email</a>
      <a class="nav-link" data-toggle="tab" href="#tab-text">SMS</a>
    </nav>
    <div class="buttons">
      <div class="fab fab-dir-left">
        <button class="btn btn-float btn-primary" data-toggle="button">
          <i class="fab-icon-default ti-plus"></i>
          <i class="fab-icon-active ti-close"></i>
        </button>

        <ul class="fab-buttons nav">
          <li><a class="btn btn-float btn-sm btn-info" data-provide="tooltip" title="Take user to NEW EMAIL BLAST" href='<%= new_admin_message_path() %>'><i class="ti-email"></i></a></li>
          <li><a class="btn btn-float btn-sm btn-info" data-provide="tooltip" title="Take user to NEW SMS BLAST" href="#"><i class="ti-comment-alt"></i></a></li>
        </ul>
      </div>
    </div>
  </div>
</header>

<div class="main-content">
  <div class="tab-content" id="message-tab-content">

    <div class="tab-pane fade active show" id="tab-email">
      <div class="row">

          <div class="col-lg-3">
            <div class="card">
              <ul class="nav nav-lg nav-pills flex-column">
                <li class="nav-item">
                  <a class="nav-link active" href="#tab-email-recent" data-toggle="tab">Recent<span class="badge badge-pill badge-default ml-10"><%= @recent_emails.count %></span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#tab-email-scheduled" data-toggle="tab">Scheduled<span class="badge badge-pill badge-default ml-10"><%= @scheduled_emails.count %></span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#tab-email-draft" data-toggle="tab">Draft<span class="badge badge-pill badge-default ml-10"><%= @draft_emails.count %></span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#tab-email-sent" data-toggle="tab">Sent<span class="badge badge-pill badge-default ml-10"><%= @sent_emails.count %></span></a>
                </li>
              </ul>
            </div>
          </div>

          <div class="col-lg-9 tab-content">
            <div class="card form-type-material tab-pane fade active show" id="tab-email-recent">
              <h4 class="card-title"><strong>Recent</strong> Email Blasts</h4>

              <div class="card-body">
                <%= render partial: 'emails', object: @recent_emails if @recent_emails.any? %>
              </div>

              <footer class="card-footer">
                <nav class="mt-3">
                  <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-left"></span>
                      </a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-right"></span>
                      </a>
                    </li>
                  </ul>
                </nav>
              </footer>
            </div>

            <div class="card form-type-material tab-pane fade" id="tab-email-scheduled">
              <h4 class="card-title"><strong>Scheduled</strong> Email Blasts</h4>

              <div class="card-body">
                <%= render partial: 'emails', object: @scheduled_emails if @scheduled_emails.any? %>
              </div>

              <footer class="card-footer">
                <nav class="mt-3">
                  <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-left"></span>
                      </a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-right"></span>
                      </a>
                    </li>
                  </ul>
                </nav>
              </footer>
            </div>

            <div class="card form-type-material tab-pane fade" id="tab-email-draft">
              <h4 class="card-title"><strong>Draft</strong> Email Blasts</h4>

              <div class="card-body">
                <%= render partial: 'emails', object: @draft_emails if @draft_emails.any? %>
              </div>

              <footer class="card-footer">
                <nav class="mt-3">
                  <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-left"></span>
                      </a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-right"></span>
                      </a>
                    </li>
                  </ul>
                </nav>
              </footer>
            </div>

            <div class="card form-type-material tab-pane fade" id="tab-email-sent">
              <h4 class="card-title"><strong>Sent</strong> Email Blasts</h4>

              <div class="card-body">
                <%= render partial: 'emails', object: @sent_emails if @sent_emails.any? %>
              </div>

              <footer class="card-footer">
                <nav class="mt-3">
                  <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-left"></span>
                      </a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item">
                      <a class="page-link" href="#">
                        <span class="ti-arrow-right"></span>
                      </a>
                    </li>
                  </ul>
                </nav>
              </footer>
            </div>

          </div>

        </div>
    </div>

    <div class="tab-pane fade" id="tab-text">
    </div>

    <div class="tab-pane fade" id="tab-new-email">
      <%= form_tag create_email_blast_admin_messages_path, method: :post, id: 'new-email-blast', name: 'newEmailBlast', class: 'card form-type-combine' do %>
        <input type="hidden" name="recipients" id="recipientsHidden">
        <h4 class="card-title">New <strong>email blast</strong></h4>
        <div class="card-body">
          <div class="no-border text-center">
            <div class="btn-group" data-toggle="buttons">
              <label class="btn btn-lg btn-info active">
                <input class="hide-control" type="radio" name="timingOptions2" id="option1" value="1" autocomplete="off" checked>Immediate</input>
              </label>
              <label class="btn btn-lg btn-info">
                <input class="hide-control" type="radio" name="timingOptions2" id="option2" value="2" autocomplete="off">Schedule</i>
              </label>
            </div>
          </div>

          <div id="timing_detail2" class="form-groups-attached">
            <div class="row">
              <div class="form-group col-6">
                <label>Date</label>
                <input class="form-control" type="text" data-provide="datepicker">
              </div>

              <div class="form-group col-6">
                <label for="select">Time</label>
                <input class="form-control" type="text" data-provide="timepicker">
              </div>
            </div>
          </div>
          <br>
          <div class="form-groups-attached">

            <div class="input-group">
              <span class="input-group-prepend">
                <a class="btn btn-light" type="button" data-toggle="quickview" href="#qv-to-field"><i class="ti-plus"></i></a>
              </span>
              <div class="input-group-input">
                <label>To</label>
                <input class="form-control" type="text" id="recipients">
              </div>
            </div>

            <div class="form-group">
              <label>Subject</label>
              <input class="form-control" type="text" name="subject">
            </div>

            <div class="form-group">
              <label>From</label>
              <select class="form-control" data-provide="selectpicker">
                <option>flexx. &lt;info@flexx.co&gt;</option>
                <option>Joe Tebaldi &lt;joe@flexx.co&gt;</option>
                <option>Staff Member &lt;staff@flexx.co&gt;</option>
              </select>
            </div>

            <div class="form-group">
              <label>Message</label>
              <textarea name="message" class="form-control editor" rows="10"></textarea>
            </div>

          </div>
          <div class="flexbox pull-right">
            <button id="btn_send_email" class="btn btn-bold btn-round btn-w-xl btn-primary" onclick="fillRecipientsField()">Send Message</button>
          </div>
        </div>
      <% end %>
    </div>

    <div class="tab-pane fade" id="tab-new-text">
      <form name="newTextBlast" class="card form-type-combine">
        <h4 class="card-title">New <strong>text blast</strong></h4>

        <div class="card-body">
          <div class="no-border text-center">
            <div class="btn-group" data-toggle="buttons">
              <label class="btn btn-lg btn-info active">
                <input class="hide-control" type="radio" name="timingOptions" id="option1" value="1" autocomplete="off" checked>Immediate</i>
              </label>
              <label class="btn btn-lg btn-info">
                <input class="hide-control" type="radio" name="timingOptions" id="option2" value="2" autocomplete="off">Schedule</i>
              </label>
            </div>
          </div>

          <div id="timing_detail" class="form-groups-attached">
            <div class="row">
              <div class="form-group col-6">
                <label>Date</label>
                <input class="form-control" type="text" data-provide="datepicker">
              </div>

              <div class="form-group col-6">
                <label for="select">Time</label>
                <input class="form-control" type="text" data-provide="timepicker">
              </div>
            </div>
          </div>
          <br>
          <div class="form-groups-attached">

            <div class="input-group">
              <span class="input-group-prepend">
                <a class="btn btn-light" type="button" data-toggle="quickview" href="#qv-to-field"><i class="ti-plus"></i></a>
              </span>
              <div class="input-group-input">
                <label>To</label>
                <input class="form-control" type="text">
              </div>
            </div>

            <div class="form-group">
              <label>Message</label>
              <textarea class="form-control" rows="6" maxlength="320" data-provide="maxlength" data-alwaysShow="true"></textarea>
            </div>

          </div>
          <div class="flexbox pull-right">
            <button id="btn_send_text" class="btn btn-bold btn-round btn-w-xl btn-primary">Send Message</button>
          </div>
        </div>
      </form>
    </div>

  </div>
</div>

<!-- Quickviews and Modals -->

<%= render partial: "report", collection: @sent_emails, as: :email %>

<!-- Temp Modal -->
<div class="modal modal-center fade" id="modal-center" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">TEMPORARY MODAL</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Take user to scheduled or draft email.</p>
        <br><br><br><br><br><br>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-bold btn-pure btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
