<header class="quickview-header">
  <p class="quickview-title lead">Complete<%= 'd' if @task.done? %>: <strong><%= @task.title %></strong></p>
  <span class="close"><i class="ti-close"></i></span>
</header>
  <div class="quickview-body">
    <div class="card no-margin">
      <div class="card-body card-inverse text-center pb-20">
        <span class="avatar avatar-xxl avatar-bordered"><i class="fa fa-<%= task_type_icon(task_type: @task.task_type) %> fs-30"></i></span>
        <h4 class="mt-2 mb-0"><a class="hover-primary text-white" href="#"><%= @task.contact.print_name %></a></h4>
        <span><%= @task.task_type.humanize %></span>
      </div>
      <div class="p-20">
        <span class="text-muted">Description</span>
        <br/><span><%= @task.details %></span>
      </div>
      <ul class="flexbox flex-justified text-center p-20">
        <li class="br-1 border-light">
          <span class="text-muted">Date</span><br>
          <span><%= @task.due_date.localtime.strftime('%m/%d/%Y') %></span>
        </li>
        <li>
          <span class="text-muted">Time</span><br>
          <span><%= @task.due_date.localtime.strftime('%I:%M %p') %></span>
        </li>
      </ul>
      <% unless @task.done? %>
        <%= form_tag admin_task_path(id: @task.id, format: :js), method: :patch, remote: true, authenticity_token: true, id: 'update-task-form', class: 'quickview-block form-type-combine' do %>
          <input type="hidden" name="refresh_panel" value="<%= params[:refresh_panel] %>">
          <input type="hidden" name="task[aasm_state]" id="task-status" value="<%= @task.aasm_state %>">
          <%= render partial: "plugins/flexx_plugin_crm/admin/task_actions/#{@task.task_type}" %>
        <% end %>
      <% end %>
    </div>
  </div>
  <% unless @task.done? %>
    <footer class="quickview-footer flex-row-reverse">
      <div class="btn-group">
        <button class="btn btn-success" onclick="updateTask(this)">Save</button>
        <button class="btn btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-expanded="false"></button>
        <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: top, left; top: 36px; left: 79px;">
          <a class="dropdown-item" style="display: block !important" onclick="updateTask(this)" href="#">Save</a>
          <a class="dropdown-item" style="display: block !important" onclick="updateTask(this, true)" href="#">Save and mark as done</a>
        </div>
      </div>
      <button class="btn btn-danger" type="reset">Cancel</button>
      <button class="btn btn-warning" onclick="deferTask(<%= @task.id %>, '<%= @task.due_date.localtime.strftime('%m/%d/%Y - %I:%M %p') %>')">Defer Task</button>
    </footer>
  <% end %>
