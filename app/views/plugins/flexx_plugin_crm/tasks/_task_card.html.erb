<header class="quickview-header">
  <p class="quickview-title lead">Complete: <strong><%= @task.title %></strong></p>
  <span class="close"><i class="ti-close"></i></span>
</header>
  <div class="quickview-body">
    <div class="card no-margin">
      <div class="card-body card-inverse text-center pb-20">
        <span class="avatar avatar-xxl avatar-bordered"><i class="fa fa-<%= task_type_icon(task_type: @task.task_type) %> fs-30"></i></span>
        <h4 class="mt-2 mb-0"><a class="hover-primary text-white" href="#"><%= @task.contact.print_name %></a></h4>
        <span><%= @task.task_type.humanize %></span>
      </div>
      <div class="btn-group btn-group-justified">
        <button class="btn p-10 btn-warning" data-toggle="modal" data-target="#modal-defer-task">Defer Task</button>
        <a href="#"   class="btn p-10 btn-danger text-white">Delete</a>
      </div>
      <div class="p-20">
        <span class="text-muted">Description</span>
        <br/><span><%= @task.details %></span>
      </div>
      <ul class="flexbox flex-justified text-center p-20">
        <li class="br-1 border-light">
          <span class="text-muted">Date</span><br>
          <span><%= @task.due_date.strftime('%m/%d/%Y') %></span>
        </li>
        <li>
          <span class="text-muted">Time</span><br>
          <span><%= @task.due_date.strftime('%I:%M %p') %></span>
        </li>
      </ul>
      <%= form_tag admin_task_path(id: @task.id, format: :js), method: :patch, remote: true, authenticity_token: true, id: 'update-task-form', class: 'quickview-block form-type-combine' do %>
        <input type="hidden" name="refresh_panel" value="<%= params[:refresh_panel] %>">
        <input type="hidden" name="task[aasm_state]" id="task-status" value="<%= @task.aasm_state %>">
        <%= render partial: "plugins/flexx_plugin_crm/admin/task_actions/#{@task.task_type}" %>
      <% end %>

      <div class="media-list media-list-divided bg-lighter">
        <h5 class="card-title p-15 text-muted fw-300 bt-1">Notes</h5>
        <% @task.notes.each do |note| %>
          <div class="media">
            <span class="avatar">JT</span>
            <div class="media-body">
              <p>
                <a href="#"><strong><%= note.created_by_user.print_name %></strong></a>
                <time class="float-right text-fade" ><%= time_ago_in_words(note.created_at) %></time>
              </p>
              <p><%= note.details %></p>
            </div>
          </div>
        <% end %>
      </div>
      <span class="publisher bt-1 border-fade bg-white">
        <span class="avatar">JT</span>
        <input class="publisher-input" type="text" placeholder="Type your note...">
        <a class="publisher-btn" href="#"><i class="fa fa-smile-o"></i></a>
      </span>
    </div>
  </div>
<footer class="quickview-footer flex-row-reverse">
  <div class="btn-group">
    <button class="btn btn-success" onclick="$('#update-task-form').submit();">Save</button>
    <button class="btn btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-expanded="false"></button>
    <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: top, left; top: 36px; left: 79px;">
      <a class="dropdown-item" style="display: block !important" onclick="$('#update-task-form').submit();" href="#">Save</a>
      <a class="dropdown-item" style="display: block !important" onclick="$('#task-status').val('done'); $('#update-task-form').submit();" href="#">Save and mark as done</a>
    </div>
  </div>
  <button class="btn btn-light" type="reset">Close</button>
</footer>
